---
title: "PEPA"
subtitle: "Pensamiento Estadístico en People Analytics"
author: "Arturo De Zan | Sergio Garcia Mora"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

# PEPA

![](https://youtu.be/Mz4GbMCqvcY){width="80%"}

Este es un tutorial interactivo que diseñamos para simplificar la práctica y afirmar los conocimientos vistos en las clases de **PEPA** (**P**enstamiento **E**stadístico en **P**eople **A**nalytics) y pensado para simplificar lo más posible los ejercicios sin que requiera tanto de vos escribiendo código.

Los scripts que usaremos en este documento los podés copiar y pegar para reutilizarlos en tu propia PC. Recordá que tenés estos recursos a disposición:

-   [Mapa conceptual](https://miro.com/app/board/o9J_l_mwKFM=/) de R y RStudio con sus respectivos videos explicativos.
-   [Tutorial interactivo de Introducción a R](https://chechoid.shinyapps.io/clase_1_introduccion_r_y_tidyverse/)
-   Todo el material del [Club de R para RRHH](https://drive.google.com/drive/folders/1Qck3z_t6XLRXb2vbN-00931DgdJZ0yse?usp=sharing) en Google Drive. Cada carpeta de cada mes, tiene un link a su respectivo video en Youtube. Y acá hay contenido introductorio, hasta cosas más complejas como análisis predictivos, text mining o análisis de clusters por ejemplo.

### ¿Cómo usar este tutorial?

Este tutorial va a tener distintas secciones, en las cuales vas a poder correr los resultados directamente aprentando el ícono que dice **"Run Code"**.

Por ejemplo, probá sumar 2 + 2 y hacer click en **"Run Code"**.

```{r two-plus-two, exercise=TRUE}

```

El código también corre con las teclas *Ctrl+Enter.*

En cada ejercicio vas a poder encontrar pistas en la tecla **"Hint"**. Calculá tu edad en el siguiente script:

```{r edad, exercise=TRUE, exercise.lines = 9}
# Poné el año en el que naciste
anio_nacimiento <- ____
anio_actual <- 2021

# Calculá tu edad
edad <- _______ - ________

# Visualizá los resultados
edad
```

```{r edad-hint-1}
# Reemplazá las líneas ____ por el año en el que naciste
# Para calcular tu edad restá el año actual menos tu año de nacimiento
```

```{r edad-hint-2}
# Poné el año en el que naciste
anio_nacimiento <- 1979
anio_actual <- 2021

# Calculá tu edad
edad <- anio_actual - anio_nacimiento

# Visualizá los resultados
edad
```

Para este tutorial vamos a utilizar el dataset de la **Encuesta KIWI de Sueldos LATAM** 🥝 que están almacenados en un objeto .`RDS` que es una extensión propia de R para almacenar datos y que mantiene las características de los datos. También hay una versión `.csv` en el [repositorio de esta clase](https://github.com/chechoid/dpa-itba/tree/main/PEPA).

```{r carga-datos, echo=TRUE}
# Cargamos los datos
kiwi_ar <- readRDS("kiwi_ar.RDS")
```

### Explorando los datos

Corré la siguiente línea de código y respondé la pregunta a continuación

```{r str, exercise=TRUE}
# Ver la estructura del data frame
str(kiwi_ar)
```

```{r str-q, }
quiz(
  question("¿Cuántas filas y columnas tiene el dataframe 'salarios'?",
  answer("548 columnas y 43 variables", message = "Las observaciones son las filas y las variables son las columnas"),
  answer("548 variables y 43 filas", message = "Mirá de nuevo el resultado de la estructura del dataframe salarios. Primero indica las observaciones, y luego las variables"),
  answer("548 filas y 43 columnas", correct = TRUE, message = "Muy bien!"),
  submit_button = "Enviar respuesta",
  try_again_button = "Intenta de nuevo",
  allow_retry = TRUE
))
```

# Análisis Univariado

Con el **análisis univariado** lo que hacemos es analizar una variable a la vez. Dependiendo si la variable es *categórica* o *numérica* vamos a poder realizar distintas cálculos y análisis.

```{r librerias}
library(tidyverse)
library(funModeling)
library(summarytools)
library(scales)
```

## Trabajando con variables categóricas

Con las variables *categóricas,* ya sean *nominales* u *ordinales*, no podemos hacer calculos aritméticos como sumas, promedios y cosas por el estilo. ¿Qué podemos hacer? Por ejemplo contar casos.

```{r cate-1, exercise=TRUE}
library(tidyverse) # Limpieza y manipulación de datos

kiwi_ar %>% 
  count(puesto) # Cuenta la cantidad de casos por puesto
```

Contar casos de una variable, como en el ejemplo anterior que contamos la cantidad de respuestas recibidas para cada puesto, en estadística se llama **Distribución de Frecuencias**. ¿Por qué?

![](https://cdn.memegenerator.es/imagenes/memes/full/29/80/29808033.jpg){width="300"}

En realidad, debe haber un por qué, pero podremos sobrevivir sin saberlo.

En ocasiones, algo que permite hacer más claras las interpretaciones de los resultados es agregar los porcentajes.

```{r cate-2, exercise=TRUE}
# Tidyverse ya está cargado

# Hace click en "Run Code"
kiwi_ar %>% 
  count(puesto) %>% 
  mutate(porcentaje = percent(n / sum(n))) # Toma el valor de la celda en n y lo divide por el total de la columna n
```

Al incorporar el porcentaje en el análisis lo que estamos haciendo es agregar, lo que en estadística se llama **Frecuencias Relativas.**

En el data frame tenemos entonces tres posiciones, `Administrativo`, `Analista`, y `HRBP` que no son posiciones jerárquicas. ¿Qué porcentaje del total representan?

Dados que los datos están ordenados por jerarquía (¿cómo se llaman estas variables?) podemos sumar el porcentaje de `Administrativo` al porcentaje de `Analista`, y ese total, sumarlo a `HRBP`. Usemos la función `freq()` del paquete `summarytools` para hacerlo fácilmente.

```{r cate-3, exercise = TRUE}

kiwi_ar %>% 
  select(puesto) %>% 
  freq(report.nas = FALSE)
```

Si vamos sumando los porcentajes de cada fila, *acumulándolos* (agregando primero `Administrativo` y `Analista` y siguiendo después con `HRBP` y así sucesivamente) lo que estamos haciendo es una **Distribución de Frecuencias Relativas Acumuladas**.

Entonces, ¿qué porcentaje de las respuestas pertenecen a personas en puestos no jerárquicos?

```{r cate-4}
quiz(
  question("¿Qué porcentaje de las respuestas son de personas en posiciones no jerárquicas (considerando Administrativos, Analistas y HRBP)?",
           answer("10.40%", message = "Ese es el porcentaje de los HRBP"),
           answer("56.39%", message = "Excelente!", correct = T),
           answer("45.99%", message = "Esa es el porcentaje acumulado de Administrativo y Analista. Falta sumar el porcentaje de los HRBP."),
           submit_button = "Enviar respuesta",
           try_again_button = "Intenta de nuevo",
           allow_retry = TRUE
))
```

### Repaso

-   **Distribución de frecuencias:** Que es el conteo de ingresos por trimestre.

-   **Frecuencias relativas:** Que es el *porcentaje* que representa el conteo sobre el total.

-   **Frecuencia relativas acumuladas:** Que representa el *porcentaje acumulado* de los ingresos de cada trimestre.

### A practicar!

¿Se puede tomar mate en todas las empresas? Veamos la cantidad de respuestas de la variable `mate` para ver en cuántos casos respondieron que sí se podía tomar, y cuántos respondieron que no. Reemplazá los espacios vacíos según corresponda al nombre de la función o de la variable.

```{r cate-5, exercise=TRUE}
kiwi_ar %>% 
  count(_____)
```

```{r cate-5-hint-1}
# Reemplazá el espacio vacío dentro de la función count() con el nombre de la variable 'mate'
```

```{r cate-5-hint-2}
kiwi_ar %>% 
  count(mate)
```

¿Y qué porcentaje representan de las respuestas? Agrega una columna calculando el porcentaje (frecuencia relativa).

```{r cate-6, exercise=TRUE, exercise.lines = 5}
kiwi_ar %>% 
  ______(____) %>% # Completá con la función y la variable que corresponde
  mutate(porcentaje = round(n/sum(n),2)) # Agrega una columna con los porcentajes redondeando a 2 decimales.
```

```{r cate-6-hint-1}
# Usá la función count() para contar la cantidad de respuestas por cada caso
# La variable que queremos analizar se llama 'mate'
```

```{r cate-6-hint-2}
kiwi_ar %>% 
  count(mate) %>% # Completá con la función y la variable que corresponde
  mutate(porcentaje = round(n/sum(n),2)) # Agrega una columna con los porcentajes redondeando a 2 decimales.
```

Calcular la distribución de frecuencias acumuladas según la `region`. Reemplazá los espacios vacíos según corresponda al nombre de la función o de la variable.

```{r cate-7, exercise=TRUE, exercise.lines = 4}
kiwi_ar %>% 
  select(______) %>% 
  freq(report.nas = FALSE)
```

```{r cate-7-hint-1}
# Reemplazá el espacio vacío dentro de la función select() con el nombre de la variable 'region'
```

```{r cate-7-hint-2}
kiwi_ar %>% 
  select(region) %>% 
  freq(report.nas = FALSE)
```

## Análisis Univariado Variables Categóricas - Visualización

Para visualizar una sola variable categórica, las opciones principales son los gráficos de **barras** y los gráficos de **torta** o de **dona**, con sus respectivas ventajas y desventajas.

### Gráficos de barras

Para hacer un gráfico de barras podemos utilizar una función la función de R base `plot()` indicando la variable que queremos visualizar (indicando primero el nombre del data frame después del signo `$` el nombre de la variable).

```{r catev-1, exercise=TRUE}
# Realizar un gráfico de barra
plot(kiwi_ar$puesto)
```

Si usamos la misma función con una variable numérica vamos a obtener un gráfico diferente.

```{r catev-2, exercise=TRUE}
# Realizar un gráfico de cantidad de personas a cargo
plot(kiwi_ar$sueldo_bruto)
```

En este caso lo que hace R es asignarle un número de índice (el número de la fila) y es lo que grafica en el eje `x` mientras que en el eje `y` asigna el valor de `sueldo_bruto`.

Volvamos a los gráficos de barras.

Uno de los paquetes más utilizados para hacer visualizaciones es el paquete `ggplot2` que ya viene incorporado dentro de la suite `tidyverse`, o sea que no hace falta instalarlo aparte si ya instalamos previamente `tidyverse`. Hay muchos paquetes más para hacer visualizaciones, la ventaja de `ggplot2` es que hay muchos desarrollos y extensiones diseñadas para funcionar con sus funciones, lo cual lo hace un gran punto de partida.

Primero tenemos que "activar" el paquete con la función `library()`.

```{r catev-3, exercise=TRUE}
# Cargar el paquete con la función library()
_______(ggplot2)

# Realizar el gráfico de barras
ggplot(kiwi_ar,             # Primero indicamos el nombre del dataframe
       aes(x = puesto)) +   # Dentro de aes() mapeamos la variable que queremos graficar
  geom_bar()                # Indico el tipo de gráfico
```

```{r catev-3-hint}
# Cargar el paquete con la función library()
library(ggplot2)

# Realizar el gráfico de barras
ggplot(kiwi_ar,             # Primero indicamos el nombre del dataframe
       aes(x = puesto)) +   # Dentro de aes() mapeamos la variable que queremos graficar
  geom_bar()                # Indico el tipo de gráfico
```

`geom_bar()` requiere que le indiquemos una sola variable. Lo que hace es contar la cantidad de veces (la frecuencia) con la que aparece cada caso, y en función de la cantidad de veces que aparece cada puesto en el dataset, va aumentando el tamaño de la barra. Para más información sobre los distintos *geoms* consultar la [documentación](https://ggplot2.tidyverse.org/) del sitio de `ggplot2` o bien la [guía que confeccionamos](https://docs.google.com/document/d/1JAthc42Hno3tIhvZRrjA02zRCdS8q2uixODCBaZcPJ0/edit?usp=sharing).

```{r catev-4}
quiz(
  question("¿Qué pasa si asignamos la variable puesto al eje y?",
           answer("Nada", message = "Algo pasa, probá"),
           answer("Le agarra un virus a la compu y aparezco en la lista de los más buscados por la Interpol", message = "Les dije 1 millón de veces que no sean exagerados"),
           answer("El gráfico 'se da vuelta'", correct = TRUE, message = "Correcto! Los nombres de los puestos aparecen en el eje y (más legibles de hecho) y las barras están apaisadas"),
         submit_button = "Enviar respuesta",
         try_again_button = "Intenta de nuevo",
         allow_retry = TRUE  
  )
)
```

### Gráficos de torta

Para bien o para mal, los gráficos de torta no tienen un *geom* específico, y si bien en R base hay una función específica para hacerlos, requiere un poco de preprocesamiento previo.
