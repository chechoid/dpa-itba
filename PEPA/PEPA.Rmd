---
title: "PEPA"
subtitle: "Pensamiento Estad칤stico en People Analytics"
author: "Arturo De Zan | Sergio Garcia Mora"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

# PEPA

![](https://youtu.be/Mz4GbMCqvcY){width="80%"}

Este es un tutorial interactivo que dise침amos para simplificar la pr치ctica y afirmar los conocimientos vistos en las clases de **PEPA** (**P**enstamiento **E**stad칤stico en **P**eople **A**nalytics) y pensado para simplificar lo m치s posible los ejercicios sin que requiera tanto de vos escribiendo c칩digo.

Los scripts que usaremos en este documento los pod칠s copiar y pegar para reutilizarlos en tu propia PC. Record치 que ten칠s estos recursos a disposici칩n:

-   [Mapa conceptual](https://miro.com/app/board/o9J_l_mwKFM=/) de R y RStudio con sus respectivos videos explicativos.
-   [Tutorial interactivo de Introducci칩n a R](https://chechoid.shinyapps.io/clase_1_introduccion_r_y_tidyverse/)
-   Todo el material del [Club de R para RRHH](https://drive.google.com/drive/folders/1Qck3z_t6XLRXb2vbN-00931DgdJZ0yse?usp=sharing) en Google Drive. Cada carpeta de cada mes, tiene un link a su respectivo video en Youtube. Y ac치 hay contenido introductorio, hasta cosas m치s complejas como an치lisis predictivos, text mining o an치lisis de clusters por ejemplo.

### 쮺칩mo usar este tutorial?

Este tutorial va a tener distintas secciones, en las cuales vas a poder correr los resultados directamente aprentando el 칤cono que dice **"Run Code"**.

Por ejemplo, prob치 sumar 2 + 2 y hacer click en **"Run Code"**.

```{r two-plus-two, exercise=TRUE}

```

El c칩digo tambi칠n corre con las teclas *Ctrl+Enter.*

En cada ejercicio vas a poder encontrar pistas en la tecla **"Hint"**. Calcul치 tu edad en el siguiente script:

```{r edad, exercise=TRUE, exercise.lines = 9}
# Pon칠 el a침o en el que naciste
anio_nacimiento <- ____
anio_actual <- 2021

# Calcul치 tu edad
edad <- _______ - ________

# Visualiz치 los resultados
edad
```

```{r edad-hint-1}
# Reemplaz치 las l칤neas ____ por el a침o en el que naciste
# Para calcular tu edad rest치 el a침o actual menos tu a침o de nacimiento
```

```{r edad-hint-2}
# Pon칠 el a침o en el que naciste
anio_nacimiento <- 1979
anio_actual <- 2021

# Calcul치 tu edad
edad <- anio_actual - anio_nacimiento

# Visualiz치 los resultados
edad
```

Para este tutorial vamos a utilizar el dataset de la **Encuesta KIWI de Sueldos LATAM** 游볳 que est치n almacenados en un objeto .`RDS` que es una extensi칩n propia de R para almacenar datos y que mantiene las caracter칤sticas de los datos. Tambi칠n hay una versi칩n `.csv` en el [repositorio de esta clase](https://github.com/chechoid/dpa-itba/tree/main/PEPA).

```{r carga-datos, echo=TRUE}
# Cargamos los datos
kiwi_ar <- readRDS("kiwi_ar.RDS")
```

### Explorando los datos

Corr칠 la siguiente l칤nea de c칩digo y respond칠 la pregunta a continuaci칩n

```{r str, exercise=TRUE}
# Ver la estructura del data frame
str(kiwi_ar)
```

```{r str-q, }
quiz(
  question("쮺u치ntas filas y columnas tiene el dataframe 'salarios'?",
  answer("548 columnas y 43 variables", message = "Las observaciones son las filas y las variables son las columnas"),
  answer("548 variables y 43 filas", message = "Mir치 de nuevo el resultado de la estructura del dataframe salarios. Primero indica las observaciones, y luego las variables"),
  answer("548 filas y 43 columnas", correct = TRUE, message = "Muy bien!"),
  submit_button = "Enviar respuesta",
  try_again_button = "Intenta de nuevo",
  allow_retry = TRUE
))
```

# An치lisis Univariado

Con el **an치lisis univariado** lo que hacemos es analizar una variable a la vez. Dependiendo si la variable es *categ칩rica* o *num칠rica* vamos a poder realizar distintas c치lculos y an치lisis.

```{r librerias}
library(tidyverse)
library(funModeling)
library(summarytools)
library(scales)
```

## Trabajando con variables categ칩ricas

Con las variables *categ칩ricas,* ya sean *nominales* u *ordinales*, no podemos hacer calculos aritm칠ticos como sumas, promedios y cosas por el estilo. 쯈u칠 podemos hacer? Por ejemplo contar casos.

```{r cate-1, exercise=TRUE}
library(tidyverse) # Limpieza y manipulaci칩n de datos

kiwi_ar %>% 
  count(puesto) # Cuenta la cantidad de casos por puesto
```

Contar casos de una variable, como en el ejemplo anterior que contamos la cantidad de respuestas recibidas para cada puesto, en estad칤stica se llama **Distribuci칩n de Frecuencias**. 쯇or qu칠?

![](https://cdn.memegenerator.es/imagenes/memes/full/29/80/29808033.jpg){width="300"}

En realidad, debe haber un por qu칠, pero podremos sobrevivir sin saberlo.

En ocasiones, algo que permite hacer m치s claras las interpretaciones de los resultados es agregar los porcentajes.

```{r cate-2, exercise=TRUE}
# Tidyverse ya est치 cargado

# Hace click en "Run Code"
kiwi_ar %>% 
  count(puesto) %>% 
  mutate(porcentaje = percent(n / sum(n))) # Toma el valor de la celda en n y lo divide por el total de la columna n
```

Al incorporar el porcentaje en el an치lisis lo que estamos haciendo es agregar, lo que en estad칤stica se llama **Frecuencias Relativas.**

En el data frame tenemos entonces tres posiciones, `Administrativo`, `Analista`, y `HRBP` que no son posiciones jer치rquicas. 쯈u칠 porcentaje del total representan?

Dados que los datos est치n ordenados por jerarqu칤a (쯖칩mo se llaman estas variables?) podemos sumar el porcentaje de `Administrativo` al porcentaje de `Analista`, y ese total, sumarlo a `HRBP`. Usemos la funci칩n `freq()` del paquete `summarytools` para hacerlo f치cilmente.

```{r cate-3, exercise = TRUE}

kiwi_ar %>% 
  select(puesto) %>% 
  freq(report.nas = FALSE)
```

Si vamos sumando los porcentajes de cada fila, *acumul치ndolos* (agregando primero `Administrativo` y `Analista` y siguiendo despu칠s con `HRBP` y as칤 sucesivamente) lo que estamos haciendo es una **Distribuci칩n de Frecuencias Relativas Acumuladas**.

Entonces, 쯤u칠 porcentaje de las respuestas pertenecen a personas en puestos no jer치rquicos?

```{r cate-4}
quiz(
  question("쯈u칠 porcentaje de las respuestas son de personas en posiciones no jer치rquicas (considerando Administrativos, Analistas y HRBP)?",
           answer("10.40%", message = "Ese es el porcentaje de los HRBP"),
           answer("56.39%", message = "Excelente!", correct = T),
           answer("45.99%", message = "Esa es el porcentaje acumulado de Administrativo y Analista. Falta sumar el porcentaje de los HRBP."),
           submit_button = "Enviar respuesta",
           try_again_button = "Intenta de nuevo",
           allow_retry = TRUE
))
```

### Repaso

-   **Distribuci칩n de frecuencias:** Que es el conteo de ingresos por trimestre.

-   **Frecuencias relativas:** Que es el *porcentaje* que representa el conteo sobre el total.

-   **Frecuencia relativas acumuladas:** Que representa el *porcentaje acumulado* de los ingresos de cada trimestre.

### A practicar!

쯉e puede tomar mate en todas las empresas? Veamos la cantidad de respuestas de la variable `mate` para ver en cu치ntos casos respondieron que s칤 se pod칤a tomar, y cu치ntos respondieron que no. Reemplaz치 los espacios vac칤os seg칰n corresponda al nombre de la funci칩n o de la variable.

```{r cate-5, exercise=TRUE}
kiwi_ar %>% 
  count(_____)
```

```{r cate-5-hint-1}
# Reemplaz치 el espacio vac칤o dentro de la funci칩n count() con el nombre de la variable 'mate'
```

```{r cate-5-hint-2}
kiwi_ar %>% 
  count(mate)
```

쯏 qu칠 porcentaje representan de las respuestas? Agrega una columna calculando el porcentaje (frecuencia relativa).

```{r cate-6, exercise=TRUE, exercise.lines = 5}
kiwi_ar %>% 
  ______(____) %>% # Complet치 con la funci칩n y la variable que corresponde
  mutate(porcentaje = round(n/sum(n),2)) # Agrega una columna con los porcentajes redondeando a 2 decimales.
```

```{r cate-6-hint-1}
# Us치 la funci칩n count() para contar la cantidad de respuestas por cada caso
# La variable que queremos analizar se llama 'mate'
```

```{r cate-6-hint-2}
kiwi_ar %>% 
  count(mate) %>% # Complet치 con la funci칩n y la variable que corresponde
  mutate(porcentaje = round(n/sum(n),2)) # Agrega una columna con los porcentajes redondeando a 2 decimales.
```

Calcular la distribuci칩n de frecuencias acumuladas seg칰n la `region`. Reemplaz치 los espacios vac칤os seg칰n corresponda al nombre de la funci칩n o de la variable.

```{r cate-7, exercise=TRUE, exercise.lines = 4}
kiwi_ar %>% 
  select(______) %>% 
  freq(report.nas = FALSE)
```

```{r cate-7-hint-1}
# Reemplaz치 el espacio vac칤o dentro de la funci칩n select() con el nombre de la variable 'region'
```

```{r cate-7-hint-2}
kiwi_ar %>% 
  select(region) %>% 
  freq(report.nas = FALSE)
```

## An치lisis Univariado Variables Categ칩ricas - Visualizaci칩n

Para visualizar una sola variable categ칩rica, las opciones principales son los gr치ficos de **barras** y los gr치ficos de **torta** o de **dona**, con sus respectivas ventajas y desventajas.

### Gr치ficos de barras

Para hacer un gr치fico de barras podemos utilizar una funci칩n la funci칩n de R base `plot()` indicando la variable que queremos visualizar (indicando primero el nombre del data frame despu칠s del signo `$` el nombre de la variable).

```{r catev-1, exercise=TRUE}
# Realizar un gr치fico de barra
plot(kiwi_ar$puesto)
```

Si usamos la misma funci칩n con una variable num칠rica vamos a obtener un gr치fico diferente.

```{r catev-2, exercise=TRUE}
# Realizar un gr치fico de cantidad de personas a cargo
plot(kiwi_ar$sueldo_bruto)
```

En este caso lo que hace R es asignarle un n칰mero de 칤ndice (el n칰mero de la fila) y es lo que grafica en el eje `x` mientras que en el eje `y` asigna el valor de `sueldo_bruto`.

Volvamos a los gr치ficos de barras.

Uno de los paquetes m치s utilizados para hacer visualizaciones es el paquete `ggplot2` que ya viene incorporado dentro de la suite `tidyverse`, o sea que no hace falta instalarlo aparte si ya instalamos previamente `tidyverse`. Hay muchos paquetes m치s para hacer visualizaciones, la ventaja de `ggplot2` es que hay muchos desarrollos y extensiones dise침adas para funcionar con sus funciones, lo cual lo hace un gran punto de partida.

Primero tenemos que "activar" el paquete con la funci칩n `library()`.

```{r catev-3, exercise=TRUE}
# Cargar el paquete con la funci칩n library()
_______(ggplot2)

# Realizar el gr치fico de barras
ggplot(kiwi_ar,             # Primero indicamos el nombre del dataframe
       aes(x = puesto)) +   # Dentro de aes() mapeamos la variable que queremos graficar
  geom_bar()                # Indico el tipo de gr치fico
```

```{r catev-3-hint}
# Cargar el paquete con la funci칩n library()
library(ggplot2)

# Realizar el gr치fico de barras
ggplot(kiwi_ar,             # Primero indicamos el nombre del dataframe
       aes(x = puesto)) +   # Dentro de aes() mapeamos la variable que queremos graficar
  geom_bar()                # Indico el tipo de gr치fico
```

`geom_bar()` requiere que le indiquemos una sola variable. Lo que hace es contar la cantidad de veces (la frecuencia) con la que aparece cada caso, y en funci칩n de la cantidad de veces que aparece cada puesto en el dataset, va aumentando el tama침o de la barra. Para m치s informaci칩n sobre los distintos *geoms* consultar la [documentaci칩n](https://ggplot2.tidyverse.org/) del sitio de `ggplot2` o bien la [gu칤a que confeccionamos](https://docs.google.com/document/d/1JAthc42Hno3tIhvZRrjA02zRCdS8q2uixODCBaZcPJ0/edit?usp=sharing).

```{r catev-4}
quiz(
  question("쯈u칠 pasa si asignamos la variable puesto al eje y?",
           answer("Nada", message = "Algo pasa, prob치"),
           answer("Le agarra un virus a la compu y aparezco en la lista de los m치s buscados por la Interpol", message = "Les dije 1 mill칩n de veces que no sean exagerados"),
           answer("El gr치fico 'se da vuelta'", correct = TRUE, message = "Correcto! Los nombres de los puestos aparecen en el eje y (m치s legibles de hecho) y las barras est치n apaisadas"),
         submit_button = "Enviar respuesta",
         try_again_button = "Intenta de nuevo",
         allow_retry = TRUE  
  )
)
```

### Gr치ficos de torta

Para bien o para mal, los gr치ficos de torta no tienen un *geom* espec칤fico, y si bien en R base hay una funci칩n espec칤fica para hacerlos, requiere un poco de preprocesamiento previo.
